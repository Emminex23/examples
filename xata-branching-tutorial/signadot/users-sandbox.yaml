name: "@{sandbox-name}"
spec:
  cluster: "@{cluster}"
  description: Users service sandbox with isolated Xata database branch

  labels:
    team: platform
    service: users-service

  resources:
    - name: usersDb
      plugin: xata-branch
      params:
        parent-branch: "main"

  forks:
    - forkOf:
        kind: Deployment
        namespace: demo
        name: users-service
      customizations:
        env:
          - name: DATABASE_URL
            valueFrom:
              resource:
                name: usersDb
                outputKey: provision.connection-string
          - name: XATA_BRANCH
            valueFrom:
              resource:
                name: usersDb
                outputKey: provision.branch-name

  defaultRouteGroup:
    endpoints:
      - name: users-api
        target: http://users-service.demo.svc:3000